<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with `ipa` • ipa</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with `ipa`">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting_started.html">Getting started with `ipa`</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting started with <code>ipa</code>
</h1>
            
      
      
      <div class="hidden name"><code>getting_started.Rmd</code></div>

    </div>

    
    
<p>The <code>ipa</code> package helps create collections of imputed datasets using a specific method. The datasets are differentiated by specific tuning parameters that correspond to the method. For example, the number of neighbors used to impute missing values is a specific parameter for nearest neighbor imputation. True to its name, <code>ipa</code> is based around the process of brewing a great beer. The main steps involved are</p>
<ol style="list-style-type: decimal">
<li><p><code>brew</code> Create a container to hold your imputations</p></li>
<li><p><code>spice</code> (optional) set parameters that govern the number of imputations for the given brew</p></li>
<li><p><code>mash</code> fit models that will provide imputations</p></li>
<li><p><code>ferment</code> impute missing values in training and (optionally) testing data</p></li>
<li><p><code>bottle</code> output the imputed datasets in a tibble.</p></li>
</ol>
<div id="simulated-example" class="section level2">
<h2 class="hasAnchor">
<a href="#simulated-example" class="anchor"></a>Simulated Example</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ipa)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(recipes)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; Loading required package: dplyr</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#&gt; Attaching package: 'recipes'</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#&gt; The following object is masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">#&gt;     step</span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-20" title="20"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb1-21" title="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="co">#&gt; Attaching package: 'purrr'</span></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="co">#&gt; The following object is masked from 'package:magrittr':</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-25" title="25"><span class="co">#&gt;     set_names</span></a>
<a class="sourceLine" id="cb1-26" title="26"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-27" title="27"></a>
<a class="sourceLine" id="cb1-28" title="28"><span class="co"># random seed for reproducing these results</span></a>
<a class="sourceLine" id="cb1-29" title="29"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">329</span>)</a>
<a class="sourceLine" id="cb1-30" title="30"></a>
<a class="sourceLine" id="cb1-31" title="31"><span class="co"># simulation parameters (these are explained below)</span></a>
<a class="sourceLine" id="cb1-32" title="32">ncov =<span class="st"> </span><span class="dv">50</span></a>
<a class="sourceLine" id="cb1-33" title="33">nint =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1-34" title="34">error_sd =<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1-35" title="35">tst_miss =<span class="st"> </span><span class="fl">0.0</span></a>
<a class="sourceLine" id="cb1-36" title="36">trn_miss =<span class="st"> </span><span class="fl">0.50</span></a>
<a class="sourceLine" id="cb1-37" title="37">nobs =<span class="st"> </span><span class="dv">100000</span></a>
<a class="sourceLine" id="cb1-38" title="38">split_prop =<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span></a>
<a class="sourceLine" id="cb1-39" title="39">rho =<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1-40" title="40">nimpute =<span class="st"> </span><span class="dv">10</span></a></code></pre></div>
<p>As this is a simulation example, we’ll need to set a few parameters, describe the context we are simulating data for, and then generate our data. Suppose that</p>
<ul>
<li><p><span class="math inline">\(Y = X\beta + \epsilon\)</span>, where <span class="math inline">\(Y\)</span> is a continuous outcome, <span class="math inline">\(X\)</span> is a matrix with <code>ncov</code> = 50 covariates, <span class="math inline">\(\beta\)</span> is a vector containing coefficients that correspond to each column in <span class="math inline">\(X\)</span>, and <span class="math inline">\(\epsilon\)</span> is a random error term with standard deviation = 0.2. <code>nint</code> = 0 is the number of interactions between the columns in <span class="math inline">\(X\)</span> that impact the value of <span class="math inline">\(Y\)</span>.</p></li>
<li><p>Columns in <span class="math inline">\(X\)</span> follow an autoregressive correlation structure characterized by a correlation constant (<code>rho</code> = 0.5) such that corr<span class="math inline">\((x_i, x_j)\)</span> = <code>rho</code><span class="math inline">\(^{\left|i-j\right|}\)</span>, where <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> indicate column indices in <span class="math inline">\(X\)</span>.</p></li>
<li><p>We sample a proportion of these data (<code>split_prop</code> = 0.05) from a population of size <code>nobs</code> = 1e+05.</p></li>
<li><p>A proportion (<code>trn_miss</code> = 0.5) of the values in our sample are missing at random (i.e., the missing status of a given variable is related to other variables we measured).</p></li>
<li><p>We want to identify a strategy to handle these missing values that will optimize the accuracy of a gradient boosted decision tree ensemble, which will be constructed using <code>xgboost</code>.</p></li>
<li><p>We will test the accuracy of each <code>xgboost</code> model by using it to predict <span class="math inline">\(Y \mid X\)</span> among the full population (minus the observations in our training data).</p></li>
</ul>
<p>In the following code, I set the parameters described above and use <code>gen_simdata</code> to create a set of 50,000 observations (with 2,500 in our training sample)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"></a>
<a class="sourceLine" id="cb2-2" title="2">sim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gen_simdata.html">gen_simdata</a></span>(</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">problem_type =</span> <span class="st">'regression'</span>, <span class="co"># continuous outcome.</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">error_sd =</span> error_sd,         <span class="co"># standard deviation of error.</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="dt">ncov =</span> ncov,                 <span class="co"># number of predictors.</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="dt">nint =</span> nint,                 <span class="co"># number of interactions.</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="dt">rho =</span> rho,                   <span class="co"># autoregression constant.</span></a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="dt">nobs =</span> nobs,                 <span class="co"># total No. of observations.</span></a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="dt">split_prop =</span> split_prop,     <span class="co"># proportion used to train model.</span></a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="dt">miss_pattern =</span> <span class="st">'mar'</span>,        <span class="co"># data are missing at random.</span></a>
<a class="sourceLine" id="cb2-11" title="11">  <span class="dt">trn_miss_prop =</span> trn_miss,    <span class="co"># proportion of missing training data.</span></a>
<a class="sourceLine" id="cb2-12" title="12">  <span class="dt">tst_miss_prop =</span> tst_miss     <span class="co"># proportion of missing training data.</span></a>
<a class="sourceLine" id="cb2-13" title="13">)</a>
<a class="sourceLine" id="cb2-14" title="14"></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co"># save the vector of beta coefficients</span></a>
<a class="sourceLine" id="cb2-16" title="16">betas &lt;-<span class="st"> </span>sim[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb2-17" title="17">data &lt;-<span class="st"> </span>sim[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb2-18" title="18"></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(data)</a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">#&gt; $training</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co">#&gt; # A tibble: 5,000 x 51</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co">#&gt;    response     x1      x2     x3      x4      x5     x6     x7     x8</span></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co">#&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co">#&gt;  1  -0.0898 -0.646 NA       0.491  0.492  NA      NA     -1.35  NA    </span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co">#&gt;  2   0.715   0.684  0.0149  1.39  NA       0.509  -0.958 NA     -1.70 </span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co">#&gt;  3   0.610  -0.754  0.380   0.820  0.875  -0.216  -1.28  -2.14  -0.773</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co">#&gt;  4   0.358  -0.124 -0.461   0.294 NA      -0.990  -0.595 NA     NA    </span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co">#&gt;  5   0.137  NA      0.372  NA      0.710  NA      NA     -0.277 -0.304</span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co">#&gt;  6  -0.388  -0.658 -0.205  -1.31  -1.54   -1.69   -1.24   0.493  1.03 </span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">#&gt;  7   0.916  -0.235 -0.297   0.773  1.58    0.0585 -0.722 -1.31  -1.77 </span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="co">#&gt;  8  -0.297   0.708  1.29    1.29   1.53   -0.255   0.761  0.765 -0.285</span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="co">#&gt;  9  -0.545   0.721 NA      -0.810  0.101  NA      NA     -1.24  NA    </span></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="co">#&gt; 10  -0.240  NA     -1.61   NA     -0.0528 NA      NA     -0.510 -0.880</span></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="co">#&gt; # ... with 4,990 more rows, and 42 more variables: x9 &lt;dbl&gt;, x10 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-35" title="35"><span class="co">#&gt; #   x11 &lt;dbl&gt;, x12 &lt;dbl&gt;, x13 &lt;dbl&gt;, x14 &lt;dbl&gt;, x15 &lt;dbl&gt;, x16 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-36" title="36"><span class="co">#&gt; #   x17 &lt;dbl&gt;, x18 &lt;dbl&gt;, x19 &lt;dbl&gt;, x20 &lt;dbl&gt;, x21 &lt;dbl&gt;, x22 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-37" title="37"><span class="co">#&gt; #   x23 &lt;dbl&gt;, x24 &lt;dbl&gt;, x25 &lt;dbl&gt;, x26 &lt;dbl&gt;, x27 &lt;dbl&gt;, x28 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-38" title="38"><span class="co">#&gt; #   x29 &lt;dbl&gt;, x30 &lt;dbl&gt;, x31 &lt;dbl&gt;, x32 &lt;dbl&gt;, x33 &lt;dbl&gt;, x34 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-39" title="39"><span class="co">#&gt; #   x35 &lt;dbl&gt;, x36 &lt;dbl&gt;, x37 &lt;dbl&gt;, x38 &lt;dbl&gt;, x39 &lt;dbl&gt;, x40 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-40" title="40"><span class="co">#&gt; #   x41 &lt;dbl&gt;, x42 &lt;dbl&gt;, x43 &lt;dbl&gt;, x44 &lt;dbl&gt;, x45 &lt;dbl&gt;, x46 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-41" title="41"><span class="co">#&gt; #   x47 &lt;dbl&gt;, x48 &lt;dbl&gt;, x49 &lt;dbl&gt;, x50 &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-43" title="43"><span class="co">#&gt; $testing</span></a>
<a class="sourceLine" id="cb2-44" title="44"><span class="co">#&gt; # A tibble: 95,000 x 51</span></a>
<a class="sourceLine" id="cb2-45" title="45"><span class="co">#&gt;    response     x1     x2      x3    x4      x5     x6      x7      x8</span></a>
<a class="sourceLine" id="cb2-46" title="46"><span class="co">#&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-47" title="47"><span class="co">#&gt;  1  -0.0879 -0.903 -1.29  -1.11   0.264  0.484   0.395  0.776   0.963 </span></a>
<a class="sourceLine" id="cb2-48" title="48"><span class="co">#&gt;  2  -0.408   1.79   0.338 -0.227  0.570 -0.121  -0.479  0.328   0.368 </span></a>
<a class="sourceLine" id="cb2-49" title="49"><span class="co">#&gt;  3  -0.450  -0.734 -0.835  1.03   0.316  0.647  -0.614 -0.296  -1.36  </span></a>
<a class="sourceLine" id="cb2-50" title="50"><span class="co">#&gt;  4   0.414   1.24   1.69   0.886  1.37  -0.218   1.48   0.0870  0.782 </span></a>
<a class="sourceLine" id="cb2-51" title="51"><span class="co">#&gt;  5   0.128   1.31   2.14   1.19   0.134  1.33    1.73   1.37   -0.201 </span></a>
<a class="sourceLine" id="cb2-52" title="52"><span class="co">#&gt;  6  -0.419  -0.292 -0.505 -0.0426 0.150 -0.853  -0.961  0.0218  0.806 </span></a>
<a class="sourceLine" id="cb2-53" title="53"><span class="co">#&gt;  7   0.316  -0.544 -0.188  0.227  0.496  1.54    0.963  0.215   0.0687</span></a>
<a class="sourceLine" id="cb2-54" title="54"><span class="co">#&gt;  8   0.0231  2.20   1.83   0.848  1.27   1.93   -0.175 -0.0720  0.558 </span></a>
<a class="sourceLine" id="cb2-55" title="55"><span class="co">#&gt;  9   0.0744  1.12   1.72   1.70   0.582 -0.0269  0.209 -0.530  -0.848 </span></a>
<a class="sourceLine" id="cb2-56" title="56"><span class="co">#&gt; 10   0.451   0.372 -1.66   0.150  0.877  0.274  -0.646  0.252   0.793 </span></a>
<a class="sourceLine" id="cb2-57" title="57"><span class="co">#&gt; # ... with 94,990 more rows, and 42 more variables: x9 &lt;dbl&gt;, x10 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-58" title="58"><span class="co">#&gt; #   x11 &lt;dbl&gt;, x12 &lt;dbl&gt;, x13 &lt;dbl&gt;, x14 &lt;dbl&gt;, x15 &lt;dbl&gt;, x16 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-59" title="59"><span class="co">#&gt; #   x17 &lt;dbl&gt;, x18 &lt;dbl&gt;, x19 &lt;dbl&gt;, x20 &lt;dbl&gt;, x21 &lt;dbl&gt;, x22 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-60" title="60"><span class="co">#&gt; #   x23 &lt;dbl&gt;, x24 &lt;dbl&gt;, x25 &lt;dbl&gt;, x26 &lt;dbl&gt;, x27 &lt;dbl&gt;, x28 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-61" title="61"><span class="co">#&gt; #   x29 &lt;dbl&gt;, x30 &lt;dbl&gt;, x31 &lt;dbl&gt;, x32 &lt;dbl&gt;, x33 &lt;dbl&gt;, x34 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-62" title="62"><span class="co">#&gt; #   x35 &lt;dbl&gt;, x36 &lt;dbl&gt;, x37 &lt;dbl&gt;, x38 &lt;dbl&gt;, x39 &lt;dbl&gt;, x40 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-63" title="63"><span class="co">#&gt; #   x41 &lt;dbl&gt;, x42 &lt;dbl&gt;, x43 &lt;dbl&gt;, x44 &lt;dbl&gt;, x45 &lt;dbl&gt;, x46 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb2-64" title="64"><span class="co">#&gt; #   x47 &lt;dbl&gt;, x48 &lt;dbl&gt;, x49 &lt;dbl&gt;, x50 &lt;dbl&gt;</span></a></code></pre></div>
</div>
<div id="standard-approach" class="section level2">
<h2 class="hasAnchor">
<a href="#standard-approach" class="anchor"></a>Standard approach</h2>
<p>Imputation to the mean is a common strategy used to impute missing values for predictive models. We will use the performance of a linear model fitted to mean imputed data as a reference point for this example.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"></a>
<a class="sourceLine" id="cb3-2" title="2">reci &lt;-<span class="st"> </span><span class="kw">recipe</span>(response <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data<span class="op">$</span>training) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="st">  </span><span class="kw">step_meanimpute</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="st">  </span><span class="kw">prep</span>()</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co"># Model, predictions, and mean squared error</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co"># using mean imputation (the reference approach)</span></a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9">mdl_ref &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(response <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> <span class="kw">juice</span>(reci))</a>
<a class="sourceLine" id="cb3-10" title="10">prd_ref &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(mdl_ref, <span class="dt">newdata =</span> <span class="kw">bake</span>(reci, data<span class="op">$</span>testing))</a>
<a class="sourceLine" id="cb3-11" title="11">mse_ref &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>((prd_ref <span class="op">-</span><span class="st"> </span>data<span class="op">$</span>testing<span class="op">$</span>response)<span class="op">^</span><span class="dv">2</span>)</a></code></pre></div>
</div>
<div id="softimpute" class="section level2">
<h2 class="hasAnchor">
<a href="#softimpute" class="anchor"></a><code>softImpute</code>
</h2>
<p>soft imputation is a method based on singular value decomposition of a matrix. We will use the <code>softImpute</code> algorithm to brew a set of 20 imputed datasets with varying degrees of regularization.</p>
<div id="brew" class="section level3">
<h3 class="hasAnchor">
<a href="#brew" class="anchor"></a>Brew</h3>
<p>When you start a brew, an object is initiated with an empty list containing meta data about your missing data strategy.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"></a>
<a class="sourceLine" id="cb4-2" title="2">brew_sft &lt;-<span class="st"> </span>data<span class="op">$</span>training <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">  </span><span class="kw"><a href="../reference/brew.html">brew</a></span>(<span class="dt">outcome =</span> response, <span class="dt">flavor =</span> <span class="st">'softImpute'</span>)</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5">brew_sft</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt; A &lt;U+0001F37A&gt; to handle missing data using soft imputation. </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; Data used for imputation (outcomes are wittheld): </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; # A tibble: 5,000 x 50</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt;        x1      x2     x3      x4      x5     x6     x7     x8      x9</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt;  1 -0.646 NA       0.491  0.492  NA      NA     -1.35  NA     -0.259 </span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt;  2  0.684  0.0149  1.39  NA       0.509  -0.958 NA     -1.70  -0.0839</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt;  3 -0.754  0.380   0.820  0.875  -0.216  -1.28  -2.14  -0.773 -0.862 </span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt;  4 -0.124 -0.461   0.294 NA      -0.990  -0.595 NA     NA     NA     </span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">#&gt;  5 NA      0.372  NA      0.710  NA      NA     -0.277 -0.304 -0.285 </span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">#&gt;  6 -0.658 -0.205  -1.31  -1.54   -1.69   -1.24   0.493  1.03   0.663 </span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">#&gt;  7 -0.235 -0.297   0.773  1.58    0.0585 -0.722 -1.31  -1.77  -1.47  </span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">#&gt;  8  0.708  1.29    1.29   1.53   -0.255   0.761  0.765 -0.285 -0.473 </span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">#&gt;  9  0.721 NA      -0.810  0.101  NA      NA     -1.24  NA      0.351 </span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">#&gt; 10 NA     -1.61   NA     -0.0528 NA      NA     -0.510 -0.880 -0.394 </span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="co">#&gt; # ... with 4,990 more rows, and 41 more variables: x10 &lt;dbl&gt;, x11 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-24" title="24"><span class="co">#&gt; #   x12 &lt;dbl&gt;, x13 &lt;dbl&gt;, x14 &lt;dbl&gt;, x15 &lt;dbl&gt;, x16 &lt;dbl&gt;, x17 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co">#&gt; #   x18 &lt;dbl&gt;, x19 &lt;dbl&gt;, x20 &lt;dbl&gt;, x21 &lt;dbl&gt;, x22 &lt;dbl&gt;, x23 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-26" title="26"><span class="co">#&gt; #   x24 &lt;dbl&gt;, x25 &lt;dbl&gt;, x26 &lt;dbl&gt;, x27 &lt;dbl&gt;, x28 &lt;dbl&gt;, x29 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-27" title="27"><span class="co">#&gt; #   x30 &lt;dbl&gt;, x31 &lt;dbl&gt;, x32 &lt;dbl&gt;, x33 &lt;dbl&gt;, x34 &lt;dbl&gt;, x35 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-28" title="28"><span class="co">#&gt; #   x36 &lt;dbl&gt;, x37 &lt;dbl&gt;, x38 &lt;dbl&gt;, x39 &lt;dbl&gt;, x40 &lt;dbl&gt;, x41 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-29" title="29"><span class="co">#&gt; #   x42 &lt;dbl&gt;, x43 &lt;dbl&gt;, x44 &lt;dbl&gt;, x45 &lt;dbl&gt;, x46 &lt;dbl&gt;, x47 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="co">#&gt; #   x48 &lt;dbl&gt;, x49 &lt;dbl&gt;, x50 &lt;dbl&gt;</span></a></code></pre></div>
</div>
<div id="spice-if-you-want-to" class="section level3">
<h3 class="hasAnchor">
<a href="#spice-if-you-want-to" class="anchor"></a>Spice (if you want to)</h3>
<p>If you are going to make all these imputed datasets, you might as well make them how you like them! Spicing your brew gives you more control over how many datasets are created and the values of parameters that will be used to generate them.</p>
<p>Of course, different brews take different spices, and it is a little overwhelming trying to remember which spice goes where. For this reason, <code>ipa</code> includes helper functions <code>spicer_soft</code>, <code>spicer_nbrs</code>, and <code>spicer_rngr</code> to help add the correct arguments into the <code>spice</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"></a>
<a class="sourceLine" id="cb5-2" title="2">brew_sft &lt;-<span class="st"> </span>brew_sft <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw"><a href="../reference/spice.html">spice</a></span>(<span class="dt">with =</span> <span class="kw"><a href="../reference/spicer_soft.html">spicer_soft</a></span>(<span class="dt">n_impute =</span> <span class="dv">24</span>, <span class="dt">step_size =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co"># Note that I chose step_size so that n_impute * step_size &lt; max_rank</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co"># (spice would throw an error at me if I messed that up)</span></a>
<a class="sourceLine" id="cb5-7" title="7">brew_sft<span class="op">$</span>pars</a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt; $min_rank</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt; $max_rank</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; [1] 49</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; $n_impute</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; [1] 24</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt; $step_size</span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
</div>
<div id="mash" class="section level3">
<h3 class="hasAnchor">
<a href="#mash" class="anchor"></a>Mash</h3>
<p>Mashing the brew corresponds to the initiation of imputation for <code>ipa_brew</code> objects. Inputs of the <code>mash</code> function include parameters that directly correspond to imputation models. Again, different models take different parameters, so we rely on the <code>masher_soft</code> function to help us set parameters that matter for the <code>softImpute</code> algorithm.</p>
<p>Notably, the <code>softImpute</code> algorithm’s convergence is influenced by parameters set in the <code>mash</code> function, and it is often helpful to see model fitting output printed to the screen to diagnose convergence problems. To see that output, we use the <code>set_verbose</code> function and make our brew a little noisier.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"></a>
<a class="sourceLine" id="cb6-2" title="2">brew_sft &lt;-<span class="st"> </span>brew_sft <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw"><a href="../reference/verbose_on.html">verbose_on</a></span>(<span class="dt">level =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="st">  </span><span class="kw"><a href="../reference/mash.html">mash</a></span>(<span class="dt">with =</span> <span class="kw"><a href="../reference/masher_soft.html">masher_soft</a></span>(<span class="dt">scale_lambda =</span> <span class="fl">0.90</span>))</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; Identifying max lambda and scaling by 0.9</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; Applying biScale() to data</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; Iter 1 Total Changes 441.2108 </span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; Iter 2 Total Changes 0.09442143 </span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; Iter 3 Total Changes 0.002450227 </span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt; Iter 4 Total Changes 2.479918e-05 </span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt; Iter 5 Total Changes 3.041207e-07 </span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt; Iter 6 Total Changes 4.22631e-09 </span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">#&gt; Iter 7 Total Changes 6.345478e-11</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#&gt; Fitting soft-impute models</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#&gt; fit 1 of 24: lambda = 91.050, rank.max = 7 rank.fit = 5</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">#&gt; fit 2 of 24: lambda = 87.135, rank.max = 8 rank.fit = 6</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">#&gt; fit 3 of 24: lambda = 83.220, rank.max = 10 rank.fit = 8</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">#&gt; fit 4 of 24: lambda = 79.304, rank.max = 11 rank.fit = 9</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="co">#&gt; fit 5 of 24: lambda = 75.389, rank.max = 12 rank.fit = 10</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="co">#&gt; fit 6 of 24: lambda = 71.474, rank.max = 13 rank.fit = 11</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="co">#&gt; fit 7 of 24: lambda = 67.559, rank.max = 15 rank.fit = 13</span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">#&gt; fit 8 of 24: lambda = 63.643, rank.max = 17 rank.fit = 15</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="co">#&gt; fit 9 of 24: lambda = 59.728, rank.max = 18 rank.fit = 16</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="co">#&gt; fit 10 of 24: lambda = 55.813, rank.max = 20 rank.fit = 18</span></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="co">#&gt; fit 11 of 24: lambda = 51.898, rank.max = 22 rank.fit = 20</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="co">#&gt; fit 12 of 24: lambda = 47.983, rank.max = 24 rank.fit = 22</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co">#&gt; fit 13 of 24: lambda = 44.067, rank.max = 26 rank.fit = 24</span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="co">#&gt; fit 14 of 24: lambda = 40.152, rank.max = 28 rank.fit = 26</span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="co">#&gt; fit 15 of 24: lambda = 36.237, rank.max = 30 rank.fit = 28</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="co">#&gt; fit 16 of 24: lambda = 32.322, rank.max = 32 rank.fit = 30</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="co">#&gt; fit 17 of 24: lambda = 28.407, rank.max = 34 rank.fit = 32</span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="co">#&gt; fit 18 of 24: lambda = 24.491, rank.max = 36 rank.fit = 34</span></a>
<a class="sourceLine" id="cb6-33" title="33"><span class="co">#&gt; fit 19 of 24: lambda = 20.576, rank.max = 38 rank.fit = 36</span></a>
<a class="sourceLine" id="cb6-34" title="34"><span class="co">#&gt; fit 20 of 24: lambda = 16.661, rank.max = 40 rank.fit = 38</span></a>
<a class="sourceLine" id="cb6-35" title="35"><span class="co">#&gt; fit 21 of 24: lambda = 12.746, rank.max = 42 rank.fit = 40</span></a>
<a class="sourceLine" id="cb6-36" title="36"><span class="co">#&gt; fit 22 of 24: lambda = 8.830, rank.max = 44 rank.fit = 42</span></a>
<a class="sourceLine" id="cb6-37" title="37"><span class="co">#&gt; fit 23 of 24: lambda = 4.915, rank.max = 46 rank.fit = 44</span></a>
<a class="sourceLine" id="cb6-38" title="38"><span class="co">#&gt; fit 24 of 24: lambda = 1.000, rank.max = 48 rank.fit = 46</span></a></code></pre></div>
<p>The <code>ipa_brew</code> object’s <code>wort</code> will be filled with imputation models (i.e., the column called <code>fit</code>) after the mash is complete!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2">brew_sft<span class="op">$</span>wort</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt; # A tibble: 24 x 4</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt;    impute lambda  rank fit             </span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;int&gt; &lt;list&gt;          </span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt;  1      1   91.1     5 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt;  2      2   87.1     6 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt;  3      3   83.2     8 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt;  4      4   79.3     9 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt;  5      5   75.4    10 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt;  6      6   71.5    11 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt;  7      7   67.6    13 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt;  8      8   63.6    15 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt;  9      9   59.7    16 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; 10     10   55.8    18 &lt;named list [3]&gt;</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt; # ... with 14 more rows</span></a></code></pre></div>
</div>
<div id="ferment" class="section level3">
<h3 class="hasAnchor">
<a href="#ferment" class="anchor"></a>Ferment</h3>
<p>Missing values can occur in the training data, testing data, and validation data. An important requirement for missing value strategies is that only information from the training data should be used to impute missing data.</p>
<p>Unfortunately, some imputation strategies are not designed to work this way! For example, <code>softImpute</code> imputes missing values based on the index of the missing value in the training data, and this doesn’t generalize to testing data because testing data (by definition) are not in the training data.</p>
<p>Fortunately, <code>ferment</code> gives you options. For example, you can use <code>softImpute</code> to impute missing training data, and then use <code>kneighbors</code> to impute the testing data by matching the testing observations to their nearest neighbors in the training data. More specifically, you can tell <code>ferment</code> to impute the testing data using either the original unimputed training data or using each of the imputed training datasets, separately. The same options apply for all <code>ipa_brew</code> objects.</p>
<p>However, in this case, there are no missing values in the testing data, so we don’t need to rely on these tricks.</p>
<p>The <code>...</code> argument in <code>ferment</code> lets you supply a dataset paired with a name. The dataset you supply will get imputed, and the name you give it will appear as the column name of the imputed sets in the <code>wort</code>. For example,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"></a>
<a class="sourceLine" id="cb8-2" title="2">brew_sft &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ferment.html">ferment</a></span>(brew_sft, <span class="dt">testing =</span> data<span class="op">$</span>testing)</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">#&gt; No missing values in testing - nothing to impute.</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5">brew_sft<span class="op">$</span>wort</a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#&gt; # A tibble: 24 x 6</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#&gt;    impute lambda  rank fit            training           testing           </span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">#&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;int&gt; &lt;list&gt;         &lt;list&gt;             &lt;list&gt;            </span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">#&gt;  1      1   91.1     5 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt;  2      2   87.1     6 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt;  3      3   83.2     8 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">#&gt;  4      4   79.3     9 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">#&gt;  5      5   75.4    10 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="co">#&gt;  6      6   71.5    11 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="co">#&gt;  7      7   67.6    13 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="co">#&gt;  8      8   63.6    15 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="co">#&gt;  9      9   59.7    16 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">#&gt; 10     10   55.8    18 &lt;named list [~ &lt;tibble [5,000 x ~ &lt;tibble [95,000 x~</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co">#&gt; # ... with 14 more rows</span></a></code></pre></div>
</div>
<div id="bottle" class="section level3">
<h3 class="hasAnchor">
<a href="#bottle" class="anchor"></a>Bottle</h3>
<p>Once everything is imputed, your brew is ready to be bottled. You can choose whether you’d prefer to get the data back in the form of a <code>tibble</code> or <code>matrix</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"></a>
<a class="sourceLine" id="cb9-2" title="2">brew_sft &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bottle.html">bottle</a></span>(brew_sft, <span class="dt">type =</span> <span class="st">'tibble'</span>)</a>
<a class="sourceLine" id="cb9-3" title="3"></a>
<a class="sourceLine" id="cb9-4" title="4">brew_sft</a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt; # A tibble: 24 x 5</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt;    impute lambda  rank training              testing               </span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt;     &lt;int&gt;  &lt;dbl&gt; &lt;int&gt; &lt;list&gt;                &lt;list&gt;                </span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt;  1      1   91.1     5 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt;  2      2   87.1     6 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt;  3      3   83.2     8 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt;  4      4   79.3     9 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt;  5      5   75.4    10 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt;  6      6   71.5    11 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt;  7      7   67.6    13 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt;  8      8   63.6    15 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt;  9      9   59.7    16 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt; 10     10   55.8    18 &lt;tibble [5,000 x 51]&gt; &lt;tibble [95,000 x 51]&gt;</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt; # ... with 14 more rows</span></a></code></pre></div>
</div>
<div id="pipes-and-brews" class="section level3">
<h3 class="hasAnchor">
<a href="#pipes-and-brews" class="anchor"></a>Pipes and brews</h3>
<p>The main functions in <code>ipa_brew</code> are designed to fit neatly with the <code>%&gt;%</code> operator. We know you like to pipe while you brew.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"></a>
<a class="sourceLine" id="cb10-2" title="2">brew_sft &lt;-<span class="st"> </span>data<span class="op">$</span>training <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">  </span><span class="kw"><a href="../reference/brew.html">brew</a></span>(<span class="dt">outcome =</span> response, <span class="dt">flavor =</span> <span class="st">'softImpute'</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="st">  </span><span class="kw"><a href="../reference/verbose_on.html">verbose_on</a></span>(<span class="dt">level =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="st">  </span><span class="kw"><a href="../reference/spice.html">spice</a></span>(<span class="dt">with =</span> <span class="kw"><a href="../reference/spicer_soft.html">spicer_soft</a></span>(<span class="dt">n_impute =</span> <span class="dv">24</span>, <span class="dt">step_size =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="st">  </span><span class="kw"><a href="../reference/mash.html">mash</a></span>(<span class="dt">with =</span> <span class="kw"><a href="../reference/masher_soft.html">masher_soft</a></span>(<span class="dt">scale_lambda =</span> <span class="fl">0.90</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="st">  </span><span class="kw"><a href="../reference/ferment.html">ferment</a></span>(<span class="dt">testing =</span> data<span class="op">$</span>testing) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="st">  </span><span class="kw"><a href="../reference/bottle.html">bottle</a></span>(<span class="dt">type =</span> <span class="st">'tibble'</span>)</a></code></pre></div>
<p>Now that we have our data, we can fit a linear model to each training set, and evaluate that model’s predictions using the testing data. Our main questions are</p>
<ol style="list-style-type: decimal">
<li><p>can softImpute produce a model that is more accurate than mean imputation?</p></li>
<li><p>What are the ideal parameters for softImpute in this case?</p></li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"></a>
<a class="sourceLine" id="cb11-2" title="2">yhat_train &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(data<span class="op">$</span>training<span class="op">$</span>response)</a>
<a class="sourceLine" id="cb11-3" title="3">mse_naive &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>((yhat_train <span class="op">-</span><span class="st"> </span>data<span class="op">$</span>testing<span class="op">$</span>response)<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5">ggdat &lt;-<span class="st"> </span>brew_sft <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb11-7" title="7">    <span class="dt">mse_sft =</span> <span class="kw">map2_dbl</span>(training, testing,</a>
<a class="sourceLine" id="cb11-8" title="8">      <span class="dt">.f =</span> <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(response <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> .x) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="st">        </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="dt">newdata =</span> .y) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="st">        </span><span class="kw">subtract</span>(data<span class="op">$</span>testing<span class="op">$</span>response) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="st">        </span><span class="kw">raise_to_power</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="st">        </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>()</a>
<a class="sourceLine" id="cb11-13" title="13">    )</a>
<a class="sourceLine" id="cb11-14" title="14">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="st">  </span><span class="kw">select</span>(impute, mse_sft) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r2_sft =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mse_sft <span class="op">/</span><span class="st"> </span>mse_naive)</a></code></pre></div>
<p>Results show that all instances of softImpute have an advantage over mean imputation and that imputes 16-21 seem to provide the most accurate linear models. Using these imputed datasets rather than the reference approach (imputation to the mean) improves the testing r-squared statistic by approximately 0.014</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">ggplot</span>(ggdat, <span class="kw">aes</span>(<span class="dt">x =</span> impute, <span class="dt">y =</span> r2_sft)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">col =</span> <span class="st">'grey'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">fill =</span> <span class="st">'red'</span>, <span class="dt">col =</span> <span class="st">'grey'</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>mse_ref <span class="op">/</span><span class="st"> </span>mse_naive, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">'Imputation'</span>, <span class="dt">y =</span> <span class="st">'Testing R-squared statistic'</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="getting_started_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simulated-example">Simulated Example</a></li>
      <li><a href="#standard-approach">Standard approach</a></li>
      <li><a href="#softimpute"><code>softImpute</code></a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
